<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <base target="_top">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>(DEV)QBG Tags Excel Maker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://kit.fontawesome.com/2e507ab521.js" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600&display=swap');

        :root {
            --envcolor: #00ff08;
            --envcolortransparent: #00ff08a8;
            --envcolordark: #00a205;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Nunito', sans-serif;
            user-select: none;
        }

        button {
            position: relative;
            min-height: 30px;
            min-width: 50px;
            margin: 0 5px;
            font-size: 12px;
            font-weight: 500;
            letter-spacing: 1px;
            border-radius: 8px;
            text-transform: uppercase;
            border: 1px solid transparent;
            outline: none;
            cursor: pointer;
            background: #0d0d0d;
            overflow: hidden;
            transition: 0.25s;
            color: #ffffff;
            border-color: var(--envcolortransparent);
            padding: 5px 10px;
            font-weight: 700;
        }

        button:before,
        button:after {
            position: absolute;
            content: '';
            left: 0;
            top: 0;
            height: 100%;
            filter: blur(30px);
            opacity: 0.4;
            transition: 0.6s;
        }

        button:before {
            width: 30px;
            background: rgba(255, 255, 255, 0.6);
            transform: translateX(-130px) skewX(-45deg);
        }

        button:after {
            width: 15px;
            background: rgba(255, 255, 255, 0.6);
            transform: translateX(-130px) skewX(-45deg);
        }

        button:hover:before,
        button:hover:after {
            opacity: 0.6;
            transform: translateX(320px) skewX(-45deg);
        }

        button:hover {
            color: #ffffff;
            background: #003c96;
        }



        .row.hidden {
            display: none;
        }

        .ground {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            align-items: flex-start;
            position: relative;
            overflow: hidden;
            align-content: flex-start;
            min-height: 100vh;
        }

        select:enabled {
            cursor: pointer;
        }

        .row {
            position: relative;
            width: fit-content;
            width: 95%;
            height: fit-content;
            margin-top: 10px;
            padding: 0px 10px 0 10px;
            background-color: #0d0d0d;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            border-radius: 8px;
            transition: all 0.3s ease-out;
        }

        .row:hover {
            box-shadow: 1px 0px 6px 0px #ffffff;
        }

        .request-row {
            width: fit-content;
            width: 95%;
            height: fit-content;
            margin-top: 10px;
            padding: 10px;
            background-color: #0d0d0d;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            border-radius: 10px;
            color: white;
        }

        .request-row span {
            margin: 1px 10px;
            background-color: white;
            color: black;
            padding: 2px 10px;
            border-radius: 8px;
            font-size: 14px;
        }

        .request-row .values {

            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .row-number {
            color: #f2f2f2;
            margin: 10px;
        }

        select {
            margin: 10px;
            min-width: 10%;
            max-width: 200px;
            padding: 5px 10px;
            text-align: center;
            border-radius: 8px;
        }

        .requestwindow {
            background-color: rgb(80, 80, 80);
            position: absolute;
            width: 90%;
            color: white;
            text-align: center;
            transform: translateY(100px);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            padding: 10px 20px;
            border-radius: 10px;
            z-index: 999;
        }

        .request-window-header {
            padding: 10px;
            margin: 20px;
            background-color: rgb(53, 53, 53);
            width: 100%;
            border-radius: 10px;
        }

        .admin-login-window-header {
            padding: 10px;
            margin: 20px;
            background-color: rgb(53, 53, 53);
            width: 100%;
            border-radius: 10px;
        }

        .admin-login-window {
            background-color: rgb(80, 80, 80);
            position: absolute;
            width: 90%;
            color: white;
            text-align: center;
            transform: translateY(100px);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            padding: 10px 20px;
            border-radius: 10px;
            z-index: 999;
        }

        input {
            min-height: 20px;
            padding: 5px 10px;
            margin: 10px;
            border-radius: 8px;
            width: 300px;
        }

        .overlay {
            width: 100vw;
            height: 100vh;
            background-color: #ffffff80;
            position: absolute;
            z-index: 99;
        }

        .hidden {
            display: none !important;
        }

        button.request-approved {
            color: green;
            pointer-events: none;
            opacity: 0.5;
        }

        button.request-rejected {
            color: red;
            pointer-events: none;
            opacity: 0.5;
        }

        .request-row.acted {
            opacity: 0.5;
        }

        .request-row.acted span {
            font-size: 11px;
        }

        .select-label {
            color: var(--envcolor);
            font-size: 12px;
            position: absolute;
            transform: translate(10px, -10px);
        }

        .select-label.excluded {
            color: white;
        }

        .request-count {
            color: white;
            font-size: 20px;
        }

        #filename-box {
            width: 40%;
            min-width: 10px;
            color: #ffffff;
            padding: 5px 20px;
            position: relative;
            overflow: hidden;
        }

        #filename-inactive {
            color: white;
            min-width: 37px;
            min-height: 10px;
            cursor: text;
            /* height: 62px; */
            display: block;
        }

        #filename-active {
            outline: none;

            font-size: 18px;
            margin: 0;
            border-radius: 5px;
            background-color: rgb(67, 67, 67);
            padding: 0px 5px;
            color: white;
            border: none;
            border-bottom: 2px solid var(--envcolor);

        }

        .enabled-tags {
            width: 10%;
            display: flex;
            justify-content: flex-end;
            padding: 5px 10px;
            align-items: center;
            flex-wrap: nowrap;
        }



        .header-buttons {
            width: 50%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: nowrap;
        }

        .filename {
            font-size: 22px;
        }

        .filename-extension {
            background-color: var(--envcolordark);
            border-radius: 6px;
            padding: 0 5px;
            margin-left: 3px;
        }

        .button-disabled {
            opacity: 0.5 !important;
            pointer-events: none !important;
        }

        .no-row-text-box {
            width: 100%;
            text-align: center;
            margin: 100px;
            font-size: 35px;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            opacity: 0.5;
            pointer-events: none !important;
            user-select: none;
        }

        .no-row-text {
            width: 100%;
            margin: 20px;
        }

        .demo-button {
            margin: 0;
            pointer-events: none;
            transform: translate(0, -7px);
        }

        .request-count-span {
            color: #ffffff;
            border-radius: 8px;
            margin: 0 10px;
            padding: 2px 10px;
            opacity: 0.5;
        }

        .request-count-span.approved {
            background-color: #027402;
        }

        .request-count-span.rejected {
            background-color: red;
        }

        .request-count-span.pending {
            background-color: rgb(0, 55, 255);
        }

        .header {

            height: fit-content;
            padding: 5px 0;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            background-color: rgb(80, 80, 80);
            width: 95%;
            position: relative;
            /* position: sticky;
            top: 0; */
            /* border-radius: 50px; */
        }

        .delete-row-button {
            filter: invert(1);
            width: 35px;
            margin-left: 20px;
            cursor: pointer;
        }

        .delete-row-button:hover {
            fill: rgb(0, 255, 238);
            transition: all 0.2s ease-in-out;
        }

        .add-row-footer {
            background-color: black;
            color: white;
            font-size: 15px;
            height: fit-content;
            padding: 5px 10px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            width: 95%;
            margin-top: 5px;
        }

        .add-row-input {
            width: 60px;
            outline: none;
            color: white;
            background-color: rgb(67, 67, 67);
            border: none;
            border-bottom: 2px solid var(--envcolor);

            margin: 0;
        }

        .footer-button {
            margin: 0 10px;
            padding: 2px 10px;
            cursor: pointer;
            border-radius: 15px;
            color: var(--envcolor);
            transition: background-color 0.15s ease-in-out;
            font-weight: 700;
        }

        .footer-button:hover {
            background-color: #003c96;
        }

        .footer-section {
            border: 2px solid var(--envcolortransparent);
            padding: 3px 10px;
            min-width: 150px;
            min-height: 45px;
            margin: 3px 7px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            border-radius: 8px;
        }

        #add-row-section-demo {
            pointer-events: none;
            width: 205px;
            font-size: 15px;
            display: inline-flex;
            transform: translate(-3px, -6px);
        }

        .error-text-footer {
            margin-left: 10px;
        }

        .env-text-footer {
            font-size: 35px;
            color: var(--envcolordark);
            margin-right: 20px;
        }

        .menu-bar {
            z-index: 9999;
            color: rgb(0, 0, 0);
            font-size: 35px;
            cursor: pointer;
            transition: transform 0.7s cubic-bezier(1, -1, 0, 1);
        }

        .rotate-90 {
            transform: rotate(90deg);
        }

        .drawer {
            box-shadow: 0px 1px 9px 1px var(--envcolor);
            z-index: 999;
            min-height: 600px;
            height: fit-content;
            width: 251px;
            position: absolute;
            background-color: white;
            top: 100%;
            right: -25%;
            float: left;
            background-color: rgb(80, 80, 80);
            border: 1px solid transparent;
            border-color: var(--envcolortransparent);
            transition: right 0.8s cubic-bezier(0.98, -0.51, 0, 1.17);
        }

        .drawer.close {
            right: 0%;

        }

        .toggle {
            height: 20px;
            --toggle-width: 36px;
            --toggle-height: 20px;
            --toggle-offset: 3px;
            --toggle-outer-default: #eee;
            --toggle-outer-active: var(--envcolor);
            --toggle-inner-default: #6e6e6e;
            --toggle-inner-active: #ffffff;
            --toggle-transition: 200ms ease-out;
        }

        .toggle input {
            display: none;
        }

        .toggle label {
            position: relative;
            display: inline-flex;
            align-items: center;

            width: var(--toggle-width);
            height: var(--toggle-height);

            background-color: var(--toggle-outer-default);
            border-radius: 100vw;

            cursor: pointer;
            transition: var(--toggle-transition);
        }

        .toggle input:checked+label {
            background-color: var(--toggle-outer-active);
        }

        .toggle label::before {
            content: "";
            position: absolute;
            top: var(--toggle-offset);
            left: var(--toggle-offset);
            bottom: var(--toggle-offset);

            aspect-ratio: 1 / 1;

            background-color: var(--toggle-inner-default);
            border-radius: 50%;
            box-shadow: 0 0 10px 5px rgba(0, 0, 0, 0.05);
            transition: var(--toggle-transition);
        }

        .toggle input:checked+label::before {
            background-color: var(--toggle-inner-active);
            transform: translateX(calc(var(--toggle-width) - var(--toggle-height)));
        }







        /* for accessibility */
        .sr-only {
            border: 0 !important;
            clip: rect(1px, 1px, 1px, 1px) !important;
            -webkit-clip-path: inset(50%) !important;
            clip-path: inset(50%) !important;
            height: 1px !important;
            margin: -1px !important;
            overflow: hidden !important;
            padding: 0 !important;
            position: absolute !important;
            width: 1px !important;
            white-space: nowrap !important;
        }

        .settings-section {
            border-top: 2px solid var(--envcolor);
            position: relative;
            padding: 10px 0;
            margin-top: 10px;
        }

        .settings-section-label {
            position: absolute;
            color: white;
            top: 0;
            /* left: 50%; */
            transform: translate(0%, -50%);
            font-size: 15px;
            background-color: rgb(80, 80, 80);
            padding: 1px 5px;
        }

        .setting-toggle {
            display: flex;
            align-items: center;
            justify-content: space-around;
            width: 100%;
            padding: 2px 5px;
            margin-top: 5px;
            border-bottom: 2px solid #ffffff29;
        }

        .setting-name {
            width: 30%;
            color: white;
            font-size: 12px;
            font-weight: 700;
        }

        .setting-toggle-caret {
            color: white;
            font-size: 22px;
            cursor: pointer;
        }

        .setting-toggle-caret.disabled {
            color: rgb(80, 80, 80);
            pointer-events: none;
        }



        .setting-toggle-caret:hover {
            color: var(--envcolor);
            font-size: 20px;
        }

        .switch-disabled {
            pointer-events: none;
            opacity: 0.3;
        }

        .export-toggle-checkbox:checked+label {
            background-color: rgb(255, 140, 0) !important;
        }

        .setting-guide-element {
            display: flex;
            align-items: center;
            justify-content: space-around;
            font-size: 15px;
            padding: 5px 10px;
        }

        .setting-guide-element>span {
            width: 80%;
            text-align: center;
        }

        .settings-guide {
            color: white;
            border: 1px solid green;
        }

        .settings-guide-element i {
            font-size: 30px;
        }

        .setting-notification {
            color: rgb(255, 208, 0);
            padding: 5px;
            text-align: center;
            font-size: 15px;
            animation: colorFlash 1.5s ease-in-out 0s infinite;
        }

        @keyframes colorFlash {
            0% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;

            }

            100% {
                opacity: 0.5;

            }
        }

        .select-container {
            margin-bottom: 10px;
        }

        .selects {
            width: 90%;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            flex-wrap: wrap;
        }
    </style>
</head>

<body style="margin: 0;padding: 0;background-color: rgb(53, 53, 53);min-height: 100vh;">
    <div class="overlay hidden" onclick="overlayClicked(this)"></div>
    <div class="ground" style="min-width: 100vw;">
        <div class="requestwindow hidden">
            <span class="request-window-header">Request New Tag</span>
            <div class="request-dropdowns">
                <input type="text" placeholder="type your name" class="request-owner-value">
                <input type="text" placeholder="type your mail address" class="request-email-value">
                <select name="" id="" class="request-type-value">
                    <option value="" selected hidden>--Select Type--</option>
                </select>
                <div class="inputs">
                    <select name="" id="" class="category hidden" onchange="setRequestDropdown('subject')">
                        <option value="" selected hidden>--Select Category--</option>
                    </select>
                    <select name="" id="" class="subject hidden" onchange="setRequestDropdown('chapter')">
                        <option value="" selected hidden>--Select Subject--</option>
                    </select>
                    <select name="" id="" class="chapter hidden" onchange="setRequestDropdown('topic')">
                        <option value="" selected hidden>--Select Chapter--</option>
                    </select>
                    <select name="" id="" class="topic hidden">
                        <option value="" selected hidden>--Select Topic--</option>
                    </select>
                    <input type="text" placeholder="type a name" class="request-name-value hidden">

                </div>

                <button onclick="submitRequestedTags(this)">Submit</button>
                <button onclick="closeRequestWindow()">Close</button>
            </div>
        </div>
        <div class="admin-login-window hidden">
            <span class="admin-login-window-header">Please enter login details</span>
            <div class="login-inputs">
                <input type="text" placeholder="Username" class="admin-login-username-value">
                <input type="password" placeholder="Password" class="admin-login-password-value">
                <button onclick="submitLoginDetails(this)">Login</button>
                <button onclick="closeAdminLoginWindow()">Close</button>
            </div>
        </div>
        <div class="header">
            <div class="drawer">
                <h3 style="color: white;padding: 10px;text-align: center;">Settings</h3>
                <div class="settings-section tags-config">
                    <span class="settings-section-label">Tags Setting</span>
                    <div class="setting-toggle hidden">
                        <i class="setting-toggle-caret setting-toggle-caret-up fa-solid fa-caret-up"
                            onclick="saveTagsConfig(this,'up')"></i>
                        <i class="setting-toggle-caret setting-toggle-caret-down fa-solid fa-caret-down"
                            onclick="saveTagsConfig(this,'down')"></i>
                        <span class="setting-name"></span>
                        <div class="toggle">
                            <input type="checkbox" class="name-switch tag-toggle-checkbox" id="a"
                                onclick="saveTagsConfig(this,'tag')" />
                            <label for="a" class="tag-toggle-label">
                                <span class="sr-only">Toggle Switch</span>
                            </label>
                        </div>
                        <div class="toggle">
                            <input type="checkbox" class="name-switch export-toggle-checkbox" id="b"
                                onclick="saveTagsConfig(this,'export')" />
                            <label for="b" class="export-toggle-label">
                                <span class="sr-only">Toggle Switch</span>
                            </label>
                        </div>
                    </div>
                </div>
                <h6 class="setting-notification hidden">*(Pending Changes) Changes
                    will take effect
                    after next refresh</h6>
                <h3 style="color: white;padding: 10px;text-align: center;">Settings Guide</h3>
                <div class="settings-guide" style="pointer-events: none;opacity: 0.5;">
                    <div class="setting-guide-element">
                        <i class="fa-solid fa-caret-up"></i>
                        <span>Move Tag Up</span>
                    </div>
                    <div class="setting-guide-element">
                        <i class="fa-solid fa-caret-down"></i>
                        <span>Move Tag Down</span>
                    </div>
                    <div class="setting-guide-element">
                        <div class="toggle">
                            <input checked type="checkbox" class="name-switch tag-toggle-checkbox" id="x" />
                            <label for="x" class="tag-toggle-label">
                                <span class="sr-only">Toggle Switch</span>
                            </label>
                        </div>
                        <span>Enable Tag</span>
                    </div>
                    <div class="setting-guide-element">
                        <div class="toggle">
                            <input checked type="checkbox" class="name-switch export-toggle-checkbox" id="x" />
                            <label for="x" class="tag-toggle-label">
                                <span class="sr-only">Toggle Switch</span>
                            </label>
                        </div>
                        <span>Enable Tag Export</span>
                    </div>

                </div>
            </div>
            <span class="request-count hidden"></span>

            <div id="filename-box">
                <span class="filename" id="filename-inactive" onclick="activeFileName(event)">Untitled Tag Sheet<span
                        class="filename-extension">.XLSX</span></span>
                <input class="filename hidden" placeholder="type file name..." type="text"
                    oninput="fileNameChange(this)" id="filename-active">
            </div>
            <div class="header-buttons">
                <button class="login-button hidden" onclick="adminLogin()">Admin Login</button>
                <button class="logout-button hidden" onclick="logout()">Log out</button>
                <button class="request-tag-button non-admin-button hidden" onclick="requestNewTag()">Request New
                    Tag</button>
                <button class="export-button non-admin-button button-disabled" onclick="exportasexcel()">Export</button>
                <button class="add-row-button non-admin-button" onclick="addRow()">+Add Row</button>
            </div>
            <div class="enabled-tags">
                <!-- <i class="fa-solid fa-bars menu-bar" onclick="menuBarClicked(this)"></i> -->
                <i class="fa-solid fa-gear menu-bar" onclick="menuClicked(this)"></i>
            </div>
        </div>
        <div class="row hidden default" style="opacity: 0;">
            <span class="row-number">SN: 1</span>
            <div class="selects">
                <div class="select-container hidden default">
                    <label class="select-label">name</label>
                    <select name="" class="name" onchange="tagSelected(this)" disabled>
                        <option value="" selected hidden>--select--</option>
                    </select>
                </div>
            </div>
            <svg class="delete-row-button" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="80" height="80"
                viewBox="0 0 80 80">
                <path
                    d="M 37 6 C 35.35503 6 34 7.3550302 34 9 L 34 10 L 24.472656 10 C 22.580979 10 20.84645 11.07202 20 12.763672 L 18.882812 15 L 15.5 15 C 13.578812 15 12 16.578812 12 18.5 C 12 20.421188 13.578812 22 15.5 22 L 16.080078 22 L 19.697266 65.416016 C 19.912759 67.998204 22.089668 70 24.681641 70 L 55.320312 70 C 57.91153 70 60.087241 67.998204 60.302734 65.416016 L 63.919922 22 L 64.5 22 C 66.421188 22 68 20.421188 68 18.5 C 68 16.578812 66.421188 15 64.5 15 L 61.117188 15 L 60 12.763672 C 59.15355 11.07202 57.419021 10 55.527344 10 L 46 10 L 46 9 C 46 7.3550302 44.64497 6 43 6 L 37 6 z M 37 8 L 43 8 C 43.56503 8 44 8.4349698 44 9 L 44 10 L 36 10 L 36 9 C 36 8.4349698 36.43497 8 37 8 z M 24.472656 12 L 34.832031 12 A 1.0001 1.0001 0 0 0 35.158203 12 L 44.832031 12 A 1.0001 1.0001 0 0 0 45.158203 12 L 55.527344 12 C 56.665666 12 57.701388 12.639855 58.210938 13.658203 L 59.882812 17 L 64.5 17 C 65.340812 17 66 17.659188 66 18.5 C 66 19.340812 65.340812 20 64.5 20 L 64.085938 20 L 15.914062 20 L 15.5 20 C 14.659188 20 14 19.340812 14 18.5 C 14 17.659188 14.659188 17 15.5 17 L 20.117188 17 L 21.789062 13.658203 C 22.298613 12.639855 23.334334 12 24.472656 12 z M 24 15 A 1 1 0 0 0 23 16 A 1 1 0 0 0 24 17 A 1 1 0 0 0 25 16 A 1 1 0 0 0 24 15 z M 28 15 A 1 1 0 0 0 27 16 A 1 1 0 0 0 28 17 A 1 1 0 0 0 29 16 A 1 1 0 0 0 28 15 z M 32 15 A 1 1 0 0 0 31 16 A 1 1 0 0 0 32 17 A 1 1 0 0 0 33 16 A 1 1 0 0 0 32 15 z M 36 15 A 1 1 0 0 0 35 16 A 1 1 0 0 0 36 17 A 1 1 0 0 0 37 16 A 1 1 0 0 0 36 15 z M 40 15 A 1 1 0 0 0 39 16 A 1 1 0 0 0 40 17 A 1 1 0 0 0 41 16 A 1 1 0 0 0 40 15 z M 44 15 A 1 1 0 0 0 43 16 A 1 1 0 0 0 44 17 A 1 1 0 0 0 45 16 A 1 1 0 0 0 44 15 z M 48 15 A 1 1 0 0 0 47 16 A 1 1 0 0 0 48 17 A 1 1 0 0 0 49 16 A 1 1 0 0 0 48 15 z M 52 15 A 1 1 0 0 0 51 16 A 1 1 0 0 0 52 17 A 1 1 0 0 0 53 16 A 1 1 0 0 0 52 15 z M 56 15 A 1 1 0 0 0 55 16 A 1 1 0 0 0 56 17 A 1 1 0 0 0 57 16 A 1 1 0 0 0 56 15 z M 18.085938 22 L 61.914062 22 L 58.308594 65.248047 C 58.178088 66.811858 56.889095 68 55.320312 68 L 24.681641 68 C 23.111613 68 21.821912 66.811858 21.691406 65.248047 L 18.085938 22 z M 54.769531 26.027344 L 54.082031 26.603516 L 54.001953 26.945312 L 53.996094 27.044922 L 54.353516 27.867188 L 55.226562 28.072266 L 55.912109 27.496094 L 55.992188 27.154297 L 55.998047 27.054688 L 55.640625 26.232422 L 54.769531 26.027344 z M 39.716797 26.041016 L 39.0625 26.652344 L 39 27 L 39 27.099609 L 39.402344 27.900391 L 40.283203 28.058594 L 40.9375 27.447266 L 41 27.099609 L 41 27 L 40.597656 26.199219 L 39.716797 26.041016 z M 24.666016 26.058594 L 24.044922 26.705078 L 24.001953 27.054688 L 24.007812 27.154297 L 24.451172 27.931641 L 25.339844 28.042969 L 25.960938 27.396484 L 26.003906 27.044922 L 25.998047 26.945312 L 25.554688 26.167969 L 24.666016 26.058594 z M 54.546875 30.121094 L 53.861328 30.697266 L 53.779297 31.041016 L 53.775391 31.140625 L 54.132812 31.960938 L 55.003906 32.166016 L 55.691406 31.591797 L 55.771484 31.248047 L 55.777344 31.148438 L 55.419922 30.326172 L 54.546875 30.121094 z M 39.716797 30.140625 L 39.0625 30.753906 L 39 31.099609 L 39 31.199219 L 39.402344 32.001953 L 40.283203 32.158203 L 40.9375 31.546875 L 41 31.199219 L 41 31.099609 L 40.597656 30.298828 L 39.716797 30.140625 z M 24.886719 30.152344 L 24.265625 30.798828 L 24.222656 31.148438 L 24.228516 31.248047 L 24.671875 32.025391 L 25.560547 32.136719 L 26.181641 31.490234 L 26.224609 31.140625 L 26.220703 31.041016 L 25.775391 30.261719 L 24.886719 30.152344 z M 54.326172 34.214844 L 53.638672 34.791016 L 53.558594 35.134766 L 53.552734 35.234375 L 53.910156 36.054688 L 54.783203 36.261719 L 55.470703 35.685547 L 55.550781 35.341797 L 55.556641 35.242188 L 55.199219 34.419922 L 54.326172 34.214844 z M 39.716797 34.240234 L 39.0625 34.853516 L 39 35.199219 L 39 35.300781 L 39.402344 36.101562 L 40.283203 36.259766 L 40.9375 35.646484 L 41 35.300781 L 41 35.199219 L 40.597656 34.398438 L 39.716797 34.240234 z M 25.107422 34.246094 L 24.488281 34.892578 L 24.443359 35.242188 L 24.449219 35.341797 L 24.892578 36.119141 L 25.783203 36.230469 L 26.402344 35.583984 L 26.447266 35.234375 L 26.441406 35.134766 L 25.996094 34.355469 L 25.107422 34.246094 z M 54.105469 38.308594 L 53.417969 38.884766 L 53.337891 39.228516 L 53.332031 39.328125 L 53.689453 40.150391 L 54.5625 40.355469 L 55.248047 39.779297 L 55.330078 39.435547 L 55.333984 39.335938 L 54.976562 38.513672 L 54.105469 38.308594 z M 25.328125 38.339844 L 24.708984 38.986328 L 24.666016 39.335938 L 24.669922 39.435547 L 25.115234 40.214844 L 26.003906 40.324219 L 26.625 39.677734 L 26.667969 39.328125 L 26.662109 39.228516 L 26.21875 38.449219 L 25.328125 38.339844 z M 39.716797 38.341797 L 39.0625 38.953125 L 39 39.300781 L 39 39.400391 L 39.402344 40.201172 L 40.283203 40.359375 L 40.9375 39.746094 L 41 39.400391 L 41 39.300781 L 40.597656 38.498047 L 39.716797 38.341797 z M 53.882812 42.402344 L 53.197266 42.978516 L 53.117188 43.322266 L 53.111328 43.421875 L 53.46875 44.244141 L 54.339844 44.449219 L 55.027344 43.873047 L 55.107422 43.529297 L 55.113281 43.429688 L 54.755859 42.609375 L 53.882812 42.402344 z M 25.550781 42.433594 L 24.929688 43.080078 L 24.886719 43.429688 L 24.892578 43.529297 L 25.335938 44.308594 L 26.224609 44.417969 L 26.845703 43.771484 L 26.888672 43.421875 L 26.882812 43.322266 L 26.439453 42.542969 L 25.550781 42.433594 z M 39.716797 42.441406 L 39.0625 43.052734 L 39 43.400391 L 39 43.5 L 39.402344 44.300781 L 40.283203 44.458984 L 40.9375 43.847656 L 41 43.5 L 41 43.400391 L 40.597656 42.599609 L 39.716797 42.441406 z M 53.662109 46.498047 L 52.976562 47.072266 L 52.894531 47.416016 L 52.888672 47.515625 L 53.248047 48.337891 L 54.119141 48.542969 L 54.806641 47.966797 L 54.886719 47.623047 L 54.892578 47.523438 L 54.535156 46.703125 L 53.662109 46.498047 z M 25.771484 46.527344 L 25.150391 47.173828 L 25.107422 47.523438 L 25.113281 47.623047 L 25.556641 48.402344 L 26.447266 48.511719 L 27.066406 47.865234 L 27.111328 47.515625 L 27.105469 47.416016 L 26.660156 46.638672 L 25.771484 46.527344 z M 39.716797 46.541016 L 39.0625 47.152344 L 39 47.5 L 39 47.599609 L 39.402344 48.400391 L 40.283203 48.558594 L 40.9375 47.947266 L 41 47.599609 L 41 47.5 L 40.597656 46.699219 L 39.716797 46.541016 z M 53.441406 50.591797 L 52.753906 51.167969 L 52.673828 51.509766 L 52.667969 51.609375 L 53.025391 52.431641 L 53.898438 52.636719 L 54.583984 52.060547 L 54.666016 51.71875 L 54.669922 51.617188 L 54.3125 50.796875 L 53.441406 50.591797 z M 25.992188 50.621094 L 25.373047 51.267578 L 25.330078 51.617188 L 25.333984 51.71875 L 25.779297 52.496094 L 26.667969 52.605469 L 27.289062 51.958984 L 27.332031 51.609375 L 27.326172 51.509766 L 26.882812 50.732422 L 25.992188 50.621094 z M 39.716797 50.640625 L 39.0625 51.253906 L 39 51.599609 L 39 51.699219 L 39.402344 52.501953 L 40.283203 52.658203 L 40.9375 52.046875 L 41 51.699219 L 41 51.599609 L 40.597656 50.798828 L 39.716797 50.640625 z M 53.21875 54.685547 L 52.533203 55.261719 L 52.453125 55.603516 L 52.447266 55.703125 L 52.804688 56.525391 L 53.677734 56.730469 L 54.363281 56.154297 L 54.443359 55.8125 L 54.449219 55.712891 L 54.091797 54.890625 L 53.21875 54.685547 z M 26.214844 54.716797 L 25.59375 55.363281 L 25.550781 55.712891 L 25.556641 55.8125 L 26 56.589844 L 26.888672 56.701172 L 27.509766 56.054688 L 27.552734 55.703125 L 27.546875 55.603516 L 27.103516 54.826172 L 26.214844 54.716797 z M 39.716797 54.740234 L 39.0625 55.353516 L 39 55.699219 L 39 55.800781 L 39.402344 56.601562 L 40.283203 56.759766 L 40.9375 56.146484 L 41 55.800781 L 41 55.699219 L 40.597656 54.898438 L 39.716797 54.740234 z M 52.998047 58.779297 L 52.3125 59.355469 L 52.230469 59.697266 L 52.226562 59.798828 L 52.583984 60.619141 L 53.455078 60.824219 L 54.142578 60.25 L 54.222656 59.90625 L 54.228516 59.806641 L 53.871094 58.984375 L 52.998047 58.779297 z M 26.435547 58.810547 L 25.814453 59.457031 L 25.771484 59.806641 L 25.777344 59.90625 L 26.220703 60.683594 L 27.111328 60.794922 L 27.730469 60.148438 L 27.773438 59.798828 L 27.769531 59.697266 L 27.324219 58.919922 L 26.435547 58.810547 z M 39.716797 58.841797 L 39.0625 59.453125 L 39 59.800781 L 39 59.900391 L 39.402344 60.701172 L 40.283203 60.859375 L 40.9375 60.246094 L 41 59.900391 L 41 59.800781 L 40.597656 58.998047 L 39.716797 58.841797 z M 52.777344 62.873047 L 52.089844 63.449219 L 52.009766 63.792969 L 52.003906 63.892578 L 52.361328 64.712891 L 53.234375 64.919922 L 53.919922 64.34375 L 54.001953 64 L 54.007812 63.900391 L 53.648438 63.078125 L 52.777344 62.873047 z M 26.65625 62.904297 L 26.037109 63.550781 L 25.992188 63.900391 L 25.998047 64 L 26.443359 64.777344 L 27.332031 64.888672 L 27.953125 64.242188 L 27.996094 63.892578 L 27.990234 63.792969 L 27.546875 63.013672 L 26.65625 62.904297 z M 39.716797 62.941406 L 39.0625 63.552734 L 39 63.900391 L 39 64 L 39.402344 64.800781 L 40.283203 64.958984 L 40.9375 64.347656 L 41 64 L 41 63.900391 L 40.597656 63.099609 L 39.716797 62.941406 z">
                </path>
            </svg>
        </div>
        <div class="add-row-footer">
            <div class="add-row-section footer-section">
                <span class="add-row-text"><span class="add-row-button-2 footer-button"
                        onclick="addRowMulti(this)">Add</span> <input oninput="onInputAddRow(this)"
                        class="add-row-input" value="10" type="text"> Rows</span>
            </div>
            <div class="export-button-section button-disabled footer-section">
                <span class="export-button-2 footer-button" onclick="exportasexcel()">Export</span>
                <span class="export-rows-count-2"></span>
            </div>
            <div class="clear-all-section button-disabled footer-section">
                <span class="clear-all-button footer-button" onclick="clearAll(this)">Clear All</span>
                <span style="cursor: pointer;" class="close-undo hidden" onclick="closeUndo()">&#10060;</span>
            </div>
            <span class="env-text-footer"></span>
            <span class="error-text-footer hidden">Oops... please enter a number.</span>
        </div>
        <div class="no-row-text-box">
            <span class="no-row-text">
                Add row by clicking
                <button class="add-row-button-demo demo-button non-admin-button">+Add Row</button> button to
                start tagging.
            </span>
            <span class="no-row-text">
                Export rows by clicking
                <button class="add-row-button-demo demo-button non-admin-button">Export</button> button.
            </span>
            <span class="no-row-text">
                Use <div class="add-row-section footer-section" id="add-row-section-demo">
                    <span class="add-row-text"><span class="add-row-button-2 footer-button"
                            onclick="addRowMulti()">Add</span> <input class="add-row-input add-row-input-demo"
                            type="text"> Rows</span>
                </div> to add multiple rows with single click.
            </span>
        </div>

        <div class="request-row hidden">
            <div class="values" style="width:60%;">
                <span class="request-owner"></span>
                <span class="request-email"></span>
                <span class="request-type" style="color:#953f00;"></span>
                <span class="request-name" style="color:#953f00;"></span>
                <span class="request-category"></span>
                <span class="request-subject"></span>
                <span class="request-chapter"></span>
                <span class="request-topic"></span>
            </div>
            <button class="small approve-request-button" onclick="actRequest(this,'approved')">Approve</button>
            <button class="small reject-request-button" onclick="actRequest(this,'rejected')">Reject</button>
        </div>

    </div>
</body>
<script>
    //UI Elements
    const overlay = document.querySelector(".overlay");
    const drawer = document.querySelector(".drawer");
    const settingsSectionTagsConfig = drawer.querySelector(".settings-section.tags-config")
    const defaultTagsToggle = drawer.querySelector(".setting-toggle");
    const settingsNotification = drawer.querySelector(".setting-notification");

    const defaultRow = document.querySelector(".row.default");
    const defaultSelectBox = defaultRow.querySelector(".select-container");
    const defaultSelectsContainer = defaultRow.querySelector(".selects");

    const ground = document.querySelector(".ground")
    const noRowTextBox = document.querySelector(".no-row-text-box");
    const errorTextFooter = document.querySelector(".error-text-footer");
    const addRowInput = document.querySelector(".add-row-input")
    const exportButton = document.querySelector(".export-button");
    const addRowButton = document.querySelector(".add-row-button");
    const exportButtonSection = document.querySelector(".export-button-section");
    const clearAllButtonSection = document.querySelector(".clear-all-section");
    const exportButton2RowCount = document.querySelector(".export-rows-count-2");
    const envTextFooter = document.querySelector(".env-text-footer");
    const requestWindow = document.querySelector(".requestwindow");
    const filenameBox = document.querySelector("#filename-box");
    const adminLoginWindowEl = document.querySelector(".admin-login-window");
    //env & base urls
    const env = [`dev`, `stage`, `production`][1];
    const backEnv = [`dev`, `stage`, `production`, 'local'][3];
    const devFeaturesOn = true;
    const utilitiesAPIBaseURL = backEnv == 'local' ? `http://localhost:8080` : `https://www.api-pw-internal-utilities.in`;
    const qbgBaseURL = `https://qbg-${env == `production` ? `api` : `backend-${env}`}.penpencil.co`;
    if (env != 'production') {
        envTextFooter.innerHTML = `*${env} environment`;
        document.title = `[${env}]` + document.title
    }
    //default vars
    const defaultTagsConfig = [
        {
            name: "category",
            order: 0,
            on: true,
            export: true,
            hasParent: true
        },
        {
            name: "subject",
            order: 1,
            on: true,
            export: true,
            hasParent: true,
        },
        {
            name: "chapter",
            order: 2,
            on: true,
            export: true,
            hasParent: true
        },
        {
            name: "topic",
            order: 3,
            on: true,
            export: true,
            hasParent: true
        },
        {
            name: "subtopic",
            order: 4,
            on: true,
            export: true,
            hasParent: true
        },
        {
            name: "class",
            order: 5,
            on: false,
            export: true,
            hasParent: true
        },
        {
            name: "stream",
            order: 6,
            on: false,
            export: true,
            hasParent: true
        },
        {
            name: "section",
            order: 7,
            on: false,
            export: true,
            hasParent: true
        },
        {
            name: "unit",
            order: 8,
            on: false,
            export: true,
            hasParent: true
        },
        {
            name: "academic-year",
            order: 9,
            on: false,
            export: true,
            hasParent: true
        },
        {
            name: "difficulty",
            order: 10,
            on: true,
            export: true,
            hasParent: false,
            defaultValues: [{
                value: "1",
                displayValue: "Easy"
            },
            {
                value: "2",
                displayValue: "Medium"
            },
            {
                value: "3",
                displayValue: "Hard"
            }
            ]
        }
    ]
    let rows = 0;
    //Javascripts for click actions
    //Menu icon clicked
    function menuClicked(el) {
        el.classList.toggle('rotate-90');
        drawer.classList.toggle('close');
        overlay.classList.toggle('hidden')
    }

    //setting-up tags order & visibility in drawer
    let tagsConfiguration = JSON.parse(localStorage.getItem('tags-config')) || defaultTagsConfig;
    let tagsConfigurationAtStart = [];
    tagsConfiguration.forEach(tag => {
        tagsConfigurationAtStart.push({
            name: tag.name,
            order: tag.order,
            on: tag.on,
            export: tag.export
        })
    });
    localStorage.setItem('tags-config', JSON.stringify(tagsConfiguration));
    function renderTagsConfigurationInDrawer(config) {
        document.querySelectorAll('.setting-toggle.visible').forEach(el => {
            el.remove()
        });
        for (let x = 0; x < config.length; x++) {
            let obj = config.find(tag => tag.order === x);
            let name = obj.name;
            let on = obj.on;
            let exportOn = obj.export;
            let toggle = defaultTagsToggle.cloneNode(true);
            settingsSectionTagsConfig.appendChild(toggle);
            if (x == 0 || x == config.length - 1) {
                toggle.querySelector(`.setting-toggle-caret-${x == 0 ? 'up' : 'down'}`).classList.add("disabled")
            }
            toggle.classList.replace('hidden', 'visible');
            toggle.querySelector('.setting-name').innerHTML = name.toUpperCase();
            // toggle.querySelector('.tag-toggle-checkbox').classList.replace('name-switch', `${name.replace(" ", "-")}-switch`);
            toggle.querySelector('.tag-toggle-checkbox').setAttribute('id', `tag-${x}`);
            toggle.querySelector('.tag-toggle-label').setAttribute('for', `tag-${x}`);
            toggle.setAttribute('order', x);
            if (on) {
                toggle.querySelector('.tag-toggle-checkbox').checked = true;
            }
            // toggle.querySelector('.export-toggle-checkbox').classList.replace('name-switch', `${name.replace(" ", "-")}-switch`);
            // toggle.querySelector('.export-toggle-checkbox').setAttribute('onchange', `tagStateChange(this,"${name}")`);
            toggle.querySelector('.export-toggle-checkbox').setAttribute('id', `export-${x}`);
            toggle.querySelector('.export-toggle-label').setAttribute('for', `export-${x}`);
            if (exportOn) {
                toggle.querySelector('.export-toggle-checkbox').checked = true;
            }
        }
        checkOnCount();

        //modifying default row if visible rows = 0
        if (rows == 0) {
            modifyDefaultRow()
        }
    }
    renderTagsConfigurationInDrawer(tagsConfiguration);

    //saving tags config after changes
    function saveTagsConfig(el, direction) {
        let currentOrder = parseInt(el.parentElement.getAttribute('order'));
        let currentOrderIndex = tagsConfiguration.findIndex(x => x.order === currentOrder);
        let previousOrderIndex = tagsConfiguration.findIndex(x => x.order === currentOrder - 1);
        let nextOrderIndex = tagsConfiguration.findIndex(x => x.order === currentOrder + 1);
        if (direction == 'up') {
            tagsConfiguration[currentOrderIndex].order = currentOrder - 1;
            tagsConfiguration[previousOrderIndex].order = currentOrder;
            renderTagsConfigurationInDrawer(tagsConfiguration);
        } else if (direction == 'down') {
            tagsConfiguration[currentOrderIndex].order = currentOrder + 1;
            tagsConfiguration[nextOrderIndex].order = currentOrder;
            renderTagsConfigurationInDrawer(tagsConfiguration);

        } else {
            let id = el.getAttribute('id');
            let order = parseInt(id.split("-")[1]);
            let type;
            if (id.includes('tag')) {
                tagsConfiguration[tagsConfiguration.findIndex(x => x.order === order)].on = el.checked;
            } else if (id.includes('export')) {
                type = 'export';
                tagsConfiguration[tagsConfiguration.findIndex(x => x.order === order)].export = el.checked;
            }
        }
        detectConfigChanges(tagsConfiguration)
        localStorage.setItem('tags-config', JSON.stringify(tagsConfiguration));
        checkOnCount()
    }

    //checking toggle enabled count
    function checkOnCount() {
        let checked = document.querySelectorAll(".tag-toggle-checkbox:checked");
        if (checked.length == 2) {
            checked[0].parentElement.classList.add('switch-disabled')
        } else {
            checked.forEach(el => {
                el.parentElement.classList.remove("switch-disabled")
            })
        }
        checked = document.querySelectorAll(".export-toggle-checkbox:checked");
        if (checked.length == 2) {
            checked[0].parentElement.classList.add('switch-disabled')
        } else {
            checked.forEach(el => {
                el.parentElement.classList.remove("switch-disabled")
            })
        }
    }

    //setting up default rows according to the tags config
    function modifyDefaultRow() {
        let onTags = tagsConfiguration.filter(x => x.on);
        onTags.sort((a, b) => a.order - b.order)
        for (let index = 0; index < onTags.length; index++) {
            const obj = onTags[index];
            let child;
            for (let i = index + 1; i < onTags.length; i++) {
                if (onTags[i].hasParent && !child) {
                    child = onTags[i];
                }
            }
            const newSelectBox = defaultSelectBox.cloneNode(true);
            defaultSelectsContainer.insertBefore(newSelectBox, defaultSelectBox);
            newSelectBox.querySelector('.select-label').innerHTML = `${obj.name.toUpperCase
                ()}<i class="fa-solid ${devFeaturesOn ? "" : "hidden"} fa-copy" style="color:white;margin-left:2px;font-size:15px;" onclick="copyId(this)"></i>`;
            newSelectBox.querySelector('select').setAttribute('tag-name', obj.name);
            newSelectBox.classList.remove('hidden');
            newSelectBox.classList.replace('default', 'visible');
            if (!obj.hasParent) {
                let html = `<option value="--select--" selected hidden>--select--</option>`;
                for (let i = 0; i < obj.defaultValues.length; i++) {
                    html += `<option value="${obj.defaultValues[i].value}">${obj.defaultValues[i].displayValue}</option>`;
                }
                newSelectBox.querySelector('select').innerHTML = html;
                newSelectBox.querySelector('select').removeAttribute('disabled');
                newSelectBox.querySelector('select').removeAttribute('onchange');
            } else {
                newSelectBox.classList.add('has-child')
            }
            if (child) {
                newSelectBox.querySelector('select').setAttribute('child', child.name)
            }
            if (obj.export) {
                newSelectBox.querySelector('select').setAttribute('export', true)
            }
        }
    };

    //Modifying Request Tag Request Window
    function setUpRequestDropdowns() {
        let onTags = tagsConfiguration.filter(x => x.on);
        onTags.sort((a, b) => a.order - b.order);
        for (let index = 0; index < onTags.length; index++) {

        }
    }
    //Adding Row
    function addRow(selectedValues, howMany = 1) {
        while (howMany > 0) {
            howMany--;
            if (rows >= 500) {
                showFooterError(`Maximum 500 rows allowed for smooth performance.`)
                return;
            }
            noRowTextBox.classList.add("hidden");
            rows++;
            if (rows >= 500) {
                addRowButton.classList.add("button-disabled");
            } else {
                addRowButton.classList.remove("button-disabled");
            }
            exportButton.innerHTML = `Export (${rows} ${rows > 1 ? "Rows" : "Row"})`
            exportButton2RowCount.innerHTML = `${rows} ${rows > 1 ? "Rows" : "Row"}`
            let rowAll = document.querySelectorAll(".row");
            exportButton.classList.remove("button-disabled");
            exportButtonSection.classList.remove("button-disabled");
            clearAllButtonSection.classList.remove("button-disabled");
            let dataLastRow = [];
            if (selectedValues) {
                dataLastRow = selectedValues
            } else {
                rowAll[rowAll.length == 1 ? 0 : rowAll.length - 2].querySelectorAll("select").forEach(select => {
                    dataLastRow.push(select.selectedIndex);
                });
            }
            let newRow;
            if (rowAll.length > 1) {
                newRow = rowAll[rowAll.length - 1].cloneNode(true);
            } else {
                newRow = defaultRow.cloneNode(true);
            }

            ground.insertBefore(newRow, defaultRow);

            newRow.classList.remove('hidden');
            newRow.classList.add('row-tagging');
            newRow.querySelector(".row-number").innerHTML = `SN: ${rows}`;
            newRow.setAttribute("number", rows)
            newRow.style.opacity = "0";
            newRow.querySelector(".delete-row-button").setAttribute("onclick", `deleteRow(${rows})`);
            let count = -1;
            let selects = newRow.querySelectorAll("select");
            selects.forEach(select => {
                count++;
                select.selectedIndex = dataLastRow[count];
                if (dataLastRow[count] != 0 && count < selects.length - 1) {
                    tagSelected(select)
                }
            })
            setTimeout(() => {
                newRow.style.opacity = "1";
            }, 100);
        }
    }
    function addRowMulti(el) {
        let numRows = parseInt(addRowInput.value);
        if (!numRows || numRows <= 0) {
            showFooterError(`Oops... please enter a valid number.`)
            return;
        }

        if (rows + numRows > 500) {
            showFooterError(`Maximum 500 rows allowed for smooth performance.`);
            return;
        }
        addRow(null, numRows)
        el.scrollIntoView({ behavior: "smooth" })
    }

    //show footer error
    function showFooterError(text) {
        errorTextFooter.classList.remove("hidden");
        errorTextFooter.innerHTML = text;
        let id = makeid(10);
        errorTextFooter.setAttribute('uid', id)
        setTimeout(() => {
            if (errorTextFooter.getAttribute('uid') == id) {
                errorTextFooter.classList.add("hidden");
            }
        }, 10000);
    }

    //Fetching first dropdown Tag
    tagsConfiguration.sort((a, b) => a.order - b.order)
    let first = tagsConfiguration.find(x => x.on)
    let firstName = first.name, firstSelect = defaultRow.querySelector('select');;
    fetchTags(firstName, firstSelect)

    function fetchTags(name, select, parents) {
        let path, query = [];
        switch (name) {
            case 'category':
                path = 'category-configuration'
                break;

            case 'subject':
                path = 'subjects/v2'
                break;
            case 'chapter':
                path = 'chapters'
                break;
            case 'topic':
                path = 'topics'
                break;
            case 'subtopic':
                path = 'subtopics'
                break;
            case 'class':
                path = 'classes'
                break;
            case 'stream':
                path = 'streams'
                break;
            case 'section':
                path = 'sections'
                break;
            case 'unit':
                path = 'units'
                break;
            case 'academic-year':
                path = 'academic-years'
                break;

            default:
                return;
                break;
        }
        if (parents) {
            parents.forEach(el => {
                query.push(`${el.getAttribute('tag-name')}_id=${el.selectedOptions[0].value}`)
            });
            path += `?${query.join("&")}`
        }
        fetchReq(`${qbgBaseURL}/${path}`).then(res => {
            let data = res.data;
            data.sort(compare);
            let html = `<option value="--select--" selected hidden>--select--</option>`;
            let count = 0;
            data.forEach(obj => {
                count++;
                html += `<option value="${obj.unique_id}">${obj.english_name || obj.name}</option>`;
            });
            select.removeAttribute('disabled')
            select.innerHTML = html;
            select.parentElement.querySelector(".select-label").innerHTML = `${select.parentElement.querySelector(".select-label").innerHTML.split("(")[0]}(${count})`;
            console.log(parents ? parents[parents.length - 1].selectedOptions[0].innerHTML : "", count)
        })
    }
    //Fetch
    function fetchReq(url) {
        return new Promise((resolve, reject) => {
            fetch(`${utilitiesAPIBaseURL}/qbgtags?url=${encodeURI(url)}`).then(response => {

                response.json().then(json => {

                    resolve(json)
                })
            })
        })
    }
    //extra
    function compare(a, b) { return ((a.english_name || a.name).charCodeAt(0) > (b.english_name || b.name).charCodeAt(0) ? 1 : ((b.english_name || b.name).charCodeAt(0) > (a.english_name || a.name).charCodeAt(0)) ? -1 : 0) };
    function copyId(el) {
        let id = el.parentElement.parentElement.querySelector("select").selectedOptions[0].value
        navigator.clipboard.writeText(id)

    }
    function makeid(length) {
        let result = '';
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        const charactersLength = characters.length;
        let counter = 0;
        while (counter < length) {
            result += characters.charAt(Math.floor(Math.random() * charactersLength));
            counter += 1;
        }
        return result;
    }
    const onlyInLeft = (left, right, compareFunction) =>
        left.filter(leftValue =>
            !right.some(rightValue =>
                compareFunction(leftValue, rightValue)));
    const compareFunction = (a, b) => a.order === b.order && a.on === b.on && a.export === b.export;

    //click functions
    function tagSelected(el) {
        el.setAttribute('value-selected', true)
        let id = el.selectedOptions[0].id;
        let childElName = el.getAttribute('child');
        let childEl = el.parentElement.parentElement.querySelector(`select[tag-name='${childElName}']`);
        let parents;
        let allSelects = el.parentElement.parentElement.querySelectorAll('select[value-selected]');
        fetchTags(childElName, childEl, allSelects)
    }
    //delete row
    function deleteRow(rowNumber) {
        document.querySelector(`.row[number="${rowNumber}"]`).remove();
        rows--;
        if (rows >= 500) {
            addRowButton.classList.add("button-disabled")
        } else {
            addRowButton.classList.remove("button-disabled");
        }
        if (rows == 0) {
            exportButton.innerHTML = `Export`
            exportButton2RowCount.innerHTML = ``
            noRowTextBox.classList.remove("hidden");
            exportButton.classList.add("button-disabled");
            exportButtonSection.classList.add("button-disabled");
            clearAllButtonSection.classList.add("button-disabled");
        } else {
            exportButton.innerHTML = `Export (${rows} ${rows > 1 ? "Rows" : "Row"})`
            exportButton2RowCount.innerHTML = `Export (${rows} ${rows > 1 ? "Rows" : "Row"})`
        }
        let count = 0;
        document.querySelectorAll('.row-tagging').forEach(el => {
            count++;
            el.setAttribute("number", `${count}`);
            el.querySelector('.delete-row-button').setAttribute("onclick", `deleteRow(${count})`);
            el.querySelector(".row-number").innerHTML = `SN: ${count}`;
        });
    }

    //Checking input value of add row input
    function onInputAddRow(el) {
        if (!parseInt(el.value) || parseInt(el.value) <= 0) {
            showFooterError(`Oops... please enter a valid number.`);
            el.style.borderBottom = '2px solid red';
        } else if (parseInt(el.value) + rows > 500) {
            showFooterError(`Maximum 500 rows allowed for smooth performance.`);
            el.style.borderBottom = '2px solid red';
        } else {
            errorTextFooter.classList.add("hidden");
            el.style.borderBottom = '2px solid var(--envcolor)';
        }
    }

    //exporting as excel
    function exportasexcel() {
        let dataObject = getRowsData();
        var workbook = XLSX.utils.book_new(),
            worksheet = XLSX.utils.aoa_to_sheet(dataObject);
        workbook.SheetNames.push("Sheet1");
        workbook.Sheets["Sheet1"] = worksheet;
        XLSX.writeFile(workbook, `${document.querySelector("#filename-inactive").innerHTML}.xlsx`);
    }
    function getRowsData() {
        // let ignoreList = [];
        // dataTagsOrder.forEach(obj => {
        //     if (!obj.on) {
        //         ignoreList.push(obj.name)
        //     }
        // })
        let data = []
        const allrows = document.querySelectorAll(".row-tagging");
        let header = [];
        allrows[0].querySelectorAll("select").forEach(el => {
            if (el.getAttribute('export')) {
                header.push(el.getAttribute('tag-name').replace("-", " "))
            }
        });
        data.push(header)
        allrows.forEach(row => {
            let rowData = [];
            let selects = row.querySelectorAll("select");
            selects.forEach(select => {
                if (!select.getAttribute('export')) {
                    return;
                }
                let selectedOption = select.selectedOptions[0].value;
                rowData.push(selectedOption)
            });
            data.push(rowData)
        });
        return data;
    }
    //checking changes in tags config
    function detectConfigChanges(newConfig) {
        let match = true;
        newConfig.forEach(tag => {
            let name = tag.name;
            let obj2 = tagsConfigurationAtStart.find(x => x.name === name);
            if (tag.order !== obj2.order || tag.export !== obj2.export || tag.on !== obj2.on) {
                match = false;
            }
        });
        if (!match) {
            settingsNotification.classList.remove("hidden")
        } else {
            settingsNotification.classList.add("hidden")

        }
    }


    //Admin Area and Tag requests
    function requestNewTag() {
        overlay.classList.remove("hidden")
        requestWindow.classList.remove("hidden")
    }
    function adminLogin() {
        overlay.classList.remove("hidden")
        adminLoginWindowEl.classList.remove("hidden");
        noRowTextBox.classList.add("hidden");
        filenameBox.classList.add("hidden")
    }
    function closeRequestWindow() {
        overlay.classList.add("hidden")
        requestWindow.classList.add("hidden")
        noRowTextBox.classList.remove("hidden");
        filenameBox.classList.remove("hidden")
    }
    function closeAdminLoginWindow() {
        overlay.classList.add("hidden")
        adminLoginWindowEl.classList.add("hidden")
        noRowTextBox.classList.remove("hidden");
        filenameBox.classList.remove("hidden")
    }
</script>

</html>
